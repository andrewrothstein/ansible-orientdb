---
- name: create orientdb group
  become: yes
  become_user: root
  group: >
    name={{orientdb_group}}
    state=present

- name: create orientdb user
  become: yes
  become_user: root
  user: >-
    name={{orientdb_user}}
    group={{orientdb_group}}
    state=present

# tasks file for orientdb
- name: download tgz
  become: yes
  become_user: root
  get_url: >-
    url={{orientdb_tgz_url}}
    dest=/tmp/{{orientdb_tgz}}
    owner={{orientdb_user}}
    group={{orientdb_group}}

- name: unarchive
  become: yes
  become_user: root
  unarchive: >-
    copy=no
    src=/tmp/{{orientdb_tgz}}
    dest={{orientdb_parent}}
    owner={{orientdb_user}}
    group={{orientdb_group}}
    creates={{orientdb_parent}}/{{orientdb_name}}

- name: link /opt/orientdb
  become: yes
  become_user: root
  file: >-
    state=link
    src={{orientdb_parent}}/{{orientdb_name}}
    dest={{orientdb_home}}
    owner={{orientdb_user}}
    group={{orientdb_group}}

- name: add orientdb to default path
  become: yes
  become_user: root
  with_items:
    - etc/profile.d/orientdb.sh
  copy: >-
    src={{item}}
    dest=/{{item}}
    owner={{orientdb_user}}
    group={{orientdb_group}}
    mode=0644

- name: configurating...
  become: yes
  become_user: root
  template: >-
    src=config/{{item}}.j2
    dest={{orientdb_config_dir}}/{{item}}
    owner={{orientdb_user}}
    group={{orientdb_group}}
    mode=0600
  with_items:
    - hazelcast.xml
    - orientdb-server-config.xml
    - default-distributed-db-config.json
    
- name: install service
  become: yes
  become_user: root
  template: >-
    src=usr/lib/systemd/system/orientdb.service.j2
    dest=/usr/lib/systemd/system/orientdb.service
    owner=root
    group=root
    mode=0644
  register: orientdb_service_unit

- name: systemctl daemon-reload
  become: yes
  become_user: root
  command: systemctl daemon-reload
  when: orientdb_service_unit|changed

- name: launch orientdb service
  become: yes
  become_user: root
  service: name=orientdb state=started enabled=yes
  
    